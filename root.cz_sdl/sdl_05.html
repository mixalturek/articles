<?xml version="1.0" encoding="iso-8859-2"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="cs" lang="CS">

<head>
<meta http-equiv="content-type" content="text/html; charset=iso-8859-2" />
<meta http-equiv="content-language" content="cs" />
<meta name="author" content="all: Michal Turek - Woq; WOQ (zavináè) seznam.cz" />
<style type="text/css" media="all">@import "./data/style.css";</style>
<title>SDL: Hry nejen pro Linux (5)</title>
</head>

<body>

<h1>SDL: Hry nejen pro Linux (5)</h1>

<p class="perex">Dnes se podíváme na grafické funkce poskytované knihovnou SDL. Vzhledem k rozsáhlosti tohoto tématu zde budou uvedeny pouze nejzákladnìj¹í vìci, podrobnostem se budeme vìnovat a¾ v následujících dílech.</p>


<h2>Návratové hodnoty funkcí</h2>

<p>Vìt¹ina SDL funkcí zabývajících se grafikou dodr¾uje pravidlo, ¾e nulová návratová hodnota znaèí úspìch a mínus jednièka neúspìch. Pokud tedy nebude uvedeno jinak, platí u funkcí vracejících int tyto hodnoty. Volání funkcí, které vracejí ukazatele, by mìly být o¹etøeny klasicky na NULL.</p>


<h2>Nahrávání obrázkù z disku</h2>

<p>SDL umí nahrávat pouze obrázky ve formátu BMP, ale díky knihovnì SDL_image, která se u¾ stala defakto jeho souèástí, mù¾e programátor pou¾ívat i PCX, GIF, JPG, PNG, TGA, TIFF a dal¹í ménì známé formáty. Stejnì jako celé SDL je i SDL_image ¹íøena pod licencí GNU LGPL a lze ji najít na adrese <a href="http://www.libsdl.org/projects/SDL_image/"> http://www.libsdl.org/projects/SDL_image/</a>.</p>

<p>Po pøilinkování knihovny a vlo¾ení hlavièkového souboru SDL_image.h je mo¾né volat funkci IMG_Load(), která vrací surface nahrávaného obrázku. Formát je detekován automaticky podle pøípony, hlavièek apod.</p>

<pre>
SDL_Surface *SDL_LoadBMP(const char *file);
SDL_Surface *IMG_Load(const char *file);
</pre>


<h2>Ukládání obrázkù</h2>

<p>SDL kromì nahrávání surface z disku umo¾òuje i ukládání. Jedná se opìt pouze o formát BMP, SDL_image ukládání bohu¾el neumo¾òuje.</p>

<pre>
int SDL_SaveBMP(SDL_Surface *surface, const char *file);
</pre>


<h2>Uvolnìní surface</h2>

<p>Ke smazání surface lze pou¾ít následující funkci, která se o v¹e postará.</p>

<pre>
void SDL_FreeSurface(SDL_Surface *surface);
</pre>


<h2>Konverze formátu surface</h2>

<p>Není to podmínkou, ale pokud bude mít surface obrázku stejný formát, jako má okno, jeho zobrazení bude stát procesor mnohem ménì výkonu. Nejlep¹í ze v¹eho je ihned po vytvoøení surface zavolat funkci SDL_DisplayFormat() (resp. SDL_DisplayFormatAlpha() pro surface s alfa kanálem), která se postará o konverzi. Parametrem je pøevádìný surface a vrácen je nový surface s po¾adovaným formátem nebo NULL pøi neúspìchu.</p>

<pre>
SDL_Surface *SDL_DisplayFormat(SDL_Surface *surface);
SDL_Surface *SDL_DisplayFormatAlpha(SDL_Surface *surface);
</pre>

<p>Vý¹e uvedené funkce vyu¾ívají slu¾eb SDL_ConvertSurface(), která je jejich obecnìj¹í variantou.</p>

<pre>
SDL_Surface *SDL_ConvertSurface(SDL_Surface *src,
		SDL_PixelFormat *fmt, Uint32 flags);
</pre>

<p>První parametr opìt pøedstavuje zdrojový surface, druhým je po¾adovaný pixel formát (vìt¹inou surface_vzoru->format) a tøetím jsou flagy, které u¾ byly probrány døíve (SDL_SWSURFACE, SDL_HWSURFACE apod.).</p>


<h2>Vykreslování</h2>

<p>Základem ve¹kerého blittingu je v SDL funkce SDL_BlitSurface(), která vezme pixely ze zdrojového surface src a zkopíruje je do cílového surface dst, jím¾ je vìt¹inou, ale ne v¾dy, framebuffer okna. Funkce samozøejmì umo¾òuje specifikovat pozici a rozmìry oblasti, díky èemu¾ nemusí být kopírován celý surface.</p>

<p>Pozn.: Termín blitting obecnì oznaèuje kopírování pixelù z jedné pamìti do druhé. Nemusí se v¹ak jednat pouze o strohé pøepsání dat, ale mohou se provádìt rùzné dal¹í operace - napø. pøeskakovat pixely urèité barvy, míchat zdrojový pixel s cílovým v závislosti na alfa kanálu (blending) a podobnì. SDL_BlitSurface() vykonává v¹echny tyto operace.</p>

<pre>
int SDL_BlitSurface(SDL_Surface *src, SDL_Rect *srcrect,
		SDL_Surface *dst, SDL_Rect *dstrect);
</pre>

<p>Pokud bude za nìkterý z obdélníkù pøedán NULL, bude se pracovat s celým objektem, u cílové oblasti se pou¾ívá pouze pozice, ¾ádné roztahování nebo zmen¹ování tedy není mo¾né. Po návratu z funkce bude cílový obdélník obsahovat rozmìry oblasti, se kterými se pøi blittingu pracovalo ve skuteènosti, tato hodnota se bude hodit pøi aktualizaci okna (viz ní¾e). Výsledek blittingu do znaèné míry závisí na vlastnostech surfacù, pøedev¹ím alfa kanálu a transparentní barvì.</p>

<p>Návratovou hodnotou je klasicky 0 (úspìch) a -1 (neúspìch). Pokud bude u hardwarového surface vráceno -2, byla jeho video pamì» ztracena. V takovém pøípadì by mìl být surface znovu nahrán/vytvoøen. Stává se to bìhem pøepínání z celoobrazovkového re¾imu do okna, pokud SDL vyu¾ívá slu¾eb DirectX 5.0. Pro podrobnosti odkazuji na SDL manuál.</p>

<p>Pozn.: Mo¾ná to bude jen pøe¾itek star¹ích verzí, proto¾e SDL v souèasnosti pøepínání aplikace mezi fullscreenem a oknem pod operaèním systémem MS Windows vùbec neumo¾òuje.</p>


<h2>Aktualizace obsahu okna</h2>

<p>Aby se zobrazila právì vykreslená scéna, je potøeba vykonat je¹tì jednu operaci - aktualizovat oblast okna, na kterou se kreslilo. V parametrech funkce se pøedává neplatný obdélník, jeho¾ ¾ádná èást by nemìla pøesahovat okraje okna - neprovádí se ¾ádné testy a tedy ani oøezávání. Pokud budou pøedány samé nuly, aktualizuje se celé okno. Tyto funkce by nikdy nemìly být volány na zamknutý surface.</p>

<pre>
void SDL_UpdateRect(SDL_Surface *screen,
		Sint32 x, Sint32 y, Sint32 w, Sint32 h);
void SDL_UpdateRects(SDL_Surface *screen,
		int numrects, SDL_Rect *rects);
</pre>

<p>Co se týká druhé uvedené funkce, má stejný význam jako první, kromì toho, ¾e lze specifikovat více obdélníkù najednou. Tyto obdélníky v¹ak nejsou testovány na vzájemné pøesahy, jejich aktualizace probíhají nezávisle.</p>

<p>V pøípadì, ¾e okno pou¾ívá double buffering (SDL_DOUBLEBUF pøedaný do SDL_SetVideoMode()), buffery se prohodí voláním SDL_Flip(). Hardware pak poèká na vertikální zatmìní stínítka monitoru a a¾ poté provede po¾adovanou operaci.</p>

<pre>
int SDL_Flip(SDL_Surface *screen);
</pre>

<p>Pokud hardware double buffering nepodporuje nebo není zapnutý, je SDL_Flip() ekvivalentní volání SDL_UpdateRect(screen, 0, 0, 0, 0), èili pøekreslí se celé okno.</p>


<h2></h2>

<p></p>


<h2>Ukázkové programy</h2>

<p>Jeliko¾ by se mnoho kódu z pøíkladù poka¾dé opakovalo, budou obecnì pou¾itelné funkce umis»ovány do souborù functions.h a functions.cpp. Prozatím bude obsahovat pouze pomocnou funkci na nahrávání obrázkù z disku a funkci pro výpoèet poètu snímkù za sekundu. Animace a pohyby v programu díky FPS pobì¾í stejnì rychle na ka¾dém poèítaèi. <a href="./src/sdl_05_func.html">(zdrojový kód se zvýraznìním syntaxe)</a></p>


<h3>Hello, SDL graphic!</h3>

<p>Asi nejjednodu¹¹í program, jaký lze vytvoøit na demonstraci pou¾ití SDL grafiky. Vykresluje se v nìm jednoduchý obrázek, který byl nahrán z disku za pou¾ití knihovny SDL_image. Na své centrované pozici zùstává i pøi roztahování okna. <a href="./src/sdl_05_a.html">(zdrojový kód se zvýraznìním syntaxe)</a></p>

<div class="img"><img src="./data/05_prog_a.png" width="328" height="269" alt="Hello, SDL graphic!" /></div>


<h3>Objekt odrá¾ející se od okrajù</h3>

<p>Druhý pøíklad je o nìco slo¾itìj¹í ne¾ ten první. Místo statického obrázku je vykreslován dynamický objekt, který se pohybuje po pøímce oknem a odrá¾í se od okrajù. Díky tomu, ¾e obsahuje i alfa kanál, jím mù¾e prosvítat pozadí. <a href="./src/sdl_05_b.html">(zdrojový kód se zvýraznìním syntaxe)</a></p>

<div class="img"><img src="./data/05_prog_b.png" width="328" height="269" alt="Objekt odrazejici se od okraju" /></div>


<p>Ve vnitøního fungování programù existuje jeden rozdíl. U prvního má okno pouze jeden buffer a scéna se po vykreslení aktualizuje pomocí funkce SDL_UpdateRect(). Druhý pøíklad vyu¾ívá double buffering (je-li podporován) a scéna se musí aktualizovat voláním SDL_Flip(). SDL_UpdateRect() by v tomto pøípadì nemìlo ¾ádný efekt.</p>


<h2>Download</h2>

<p><ul>
<li><a href="http://www.libsdl.org/projects/SDL_image/">Knihovna SDL_image</a></li>
<li><a href="./src/sdl_05_a.tar.gz">Pøíklad: Hello, SDL graphic!</a></li>
<li><a href="./src/sdl_05_b.tar.gz">Pøíklad: Objekt odrá¾ející se od okrajù</a></li>
<li><a href="sdl_05.tar.gz">Offline verze èlánku vèetnì v¹ech pøíloh</a></li>
</ul></p>


<h2>Pokraèování</h2>

<p>Tento èlánek obsahoval pouze základní úvod do kreslení pomocí knihovny SDL, dal¹í podrobnosti pøijdou v následujících dílech.</p>


<div class="autor">Michal Turek - Woq &lt;WOQ (zavináè) seznam.cz&gt;, 24.02.2005</div>

</body>
</html>
