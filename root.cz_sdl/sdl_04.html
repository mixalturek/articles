<?xml version="1.0" encoding="iso-8859-2"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="cs" lang="CS">

<head>
<meta http-equiv="content-type" content="text/html; charset=iso-8859-2" />
<meta http-equiv="content-language" content="cs" />
<meta name="author" content="all: Michal Turek - Woq; WOQ (zavináè) seznam.cz" />
<style type="text/css" media="all">@import "./data/style.css";</style>
<title>SDL: Hry nejen pro Linux (4)</title>
</head>

<body>

<h1>SDL: Hry nejen pro Linux (4)</h1>

<p class="perex">V minulém dílu jsme si dopodrobna vysvìtlili inicializaci SDL, ale je¹tì nìco málo zbylo - nastavení vlastností a vytvoøení okna. Jak brzy zjistíme, v porovnání s napø. Win32 API je tato èinnost v SDL mnohem jednodu¹¹í.</p>


<h2>Vytvoøení okna</h2>

<p>V nejjednodu¹¹ím a vìt¹inou zcela dostaèujícím pøípadì se jedná pouze o volání jediné jednoduché funkce. Ne nadarmo se øíká, ¾e SDL nechává programátora koncentrovat se na vývoj vlastní hry, místo toho, aby se staral o slo¾ité detaily operaèního systému...</p>

<pre>
SDL_Surface *SDL_SetVideoMode(int width, int height,
		int bpp, Uint32 flags);
</pre>

<p>Návratovou hodnotou funkce je pøi chybì NULL, v ostatních pøípadech ukazatel na SDL_Surface. Tato struktura v SDL pøedstavuje základní a v podstatì jediný prostøedek pro ukládání pixelù obrázku a informací o nìm. V tomto pøípadì se jedná o okno (frame buffer) aplikace. V¹echny funkce, které SDL poskytuje pro 2D grafiku, jsou realizovány nad touto strukturou.</p>

<p>Parametry width a height urèují ¹íøku klientské oblasti okna, bpp specifikuje barevnou hloubku v bitech. Pokud se vlo¾í hodnota 0, bude pou¾ita barevná hloubka aktuálnì nastavená v systému. Parametr flags specifikuje vlastnosti okna a lze pøedat nìkterou z následujících symbolických konstant nebo jejich kombinaci (binární OR).</p>


<ul>
<li class="vspace">SDL_SWSURFACE, SDL_HWSURFACE<br />Vytvoøí surface v systémové nebo video pamìti. Pokud nebudou pixely surface èasto modifikovány, je lep¹í je ulo¾it pøímo do video pamìti, proto¾e se pak bude vyu¾ívat hardwarové akcelerace.</li>

<li class="vspace">SDL_ASYNCBLIT<br />Povolí asynchronní aktualizaci surface. Tímto se sice na jednoprocesorových systémech blitting (kreslení jednoho obrázku do druhého) vìt¹inou zpomalí, ale na SMP systémech dojde ke zrychlení.</li>

<li class="vspace">SDL_ANYFORMAT<br />Obyèejnì, pokud není po¾adovaná barevná hloubka video surface dostupná, SDL pøistoupí k emulaci. Pøedáním SDL_ANYFORMAT se tomuto pøedejte - SDL pou¾ije video surface s jakoukoli z dostupných barevných hloubek, ale bez emulace.</li>

<li class="vspace">SDL_HWPALETTE<br />Poskytne SDL exkluzivní pøístup k paletì. Bez tohoto flagu nemusí v¾dy jít získat barva po¾adovaná pøes SDL_SetColors() nebo SDL_SetPalette().</li>

<li class="vspace">SDL_DOUBLEBUF<br />Povolí hardwarový double buffering. Ve¹keré kreslení se pak bude provádìt na skrytém/nezobrazeném bufferu. Po jeho ukonèení se buffery zamìní voláním SDL_Flip(). Tento parametr je validní pouze spolu se SDL_HWSURFACE.</li>

<li class="vspace">SDL_FULLSCREEN<br />Aplikace nepobì¾í v oknì, ale v celoobrazovkovém re¾imu. Pokud není z jakéhokoli dùvodu zmìna hardwarového rozli¹ení mo¾ná, bude pou¾ito následující vy¹¹í rozli¹ení a scéna se vycentruje na èerném pozadí.</li>

<li class="vspace">SDL_OPENGL<br />Vytvoøí okno s podporou OpenGL. Pøed vlastním voláním SDL_SetVideoMode() by mìly být ji¾ nastaveny atributy pøes SDL_GL_SetAttribute(), pozdìj¹í zmìna ji¾ není mo¾ná. Pou¾ití OpenGL bude vìnován nìkterý z budoucích dílù.</li>

<li class="vspace">SDL_OPENGLBLIT<br />Má stejný význam jako pøedchozí parametr, ale s tím rozdílem, ¾e bude zároveò mo¾né provádìt SDL blitting. Scéna (2D) mù¾e mít alfa kanál a pro aktualizaci musí být pou¾ito SDL_UpdateRects().</li>

<li class="vspace">SDL_RESIZABLE<br />Bude mo¾ná zmìna velikosti okna. Pøi roztahování se bude generovat událost SDL_VIDEORESIZE a mù¾e být opìt zavoláno SDL_SetVideoMode() s novými rozmìry.</li>

<li class="vspace">SDL_NOFRAME<br />Pokud je to mo¾né, vytvoøí okno bez titulku a rámu. V celoobrazovkovém re¾imu se nastavuje automaticky.</li>
</ul>

<p>Pozn.: Pokud je funkcionalita poskytovaná daným parametrem z nìjakého dùvodu dùle¾itá, lze otestovat flagy z vráceného surface.</p>


<h2>Získání video surface</h2>

<p>Ukazatel na aktuální zobrazený surface lze získat pomocí následující funkce. V pøípadì, ¾e SDL provádí nìjaké konverze formátu, bude vrácen veøejnì viditelný surface, ne opravdový.</p>

<pre>
SDL_Surface *SDL_GetVideoSurface(void);
</pre>


<h2>Zji¹tìní dostupnosti video formátu</h2>

<p>Pøed samotným vytvoøením okna mù¾e být dobré nejdøíve zjistit, zda jsou po¾adované parametry vùbec dostupné.</p>

<pre>
int SDL_VideoModeOK(int width, int height,
		int bpp, Uint32 flags);
</pre>

<p>Funkce vrací hodnotu barevné hloubky pro nejbli¾¹í dostupný mód v závislosti na pøedané ¹íøce, vý¹ce a vlastnostech, parametry jsou tedy stejné jako u funkce SDL_VideoMode(). Jediným rozdílem je, ¾e nulová barevná hloubka (aktuálnì nastavená v systému) není pro tuto funkci validní! Pokud není mód podporován pod ¾ádnou barevnou hloubkou, je vrácena nula.</p>


<h2>Seznam dostupných rozmìrù okna</h2>

<p>Pomocí funkce SDL_ListModes() je programátor schopen nagrabovat v¹echna dostupná rozli¹ení pro daný formát pixelù a vlastnosti.</p>

<pre>
SDL_Rect **SDL_ListModes(SDL_PixelFormat *format, Uint32 flags);
</pre>

<p>Návratovou hodnotou je ukazatel na pole obdélníkù, které budou navíc seøazené od nejvìt¹ích rozmìrù po nejmen¹í. V pøípadì, ¾e bude vrácen NULL nejsou dostupná ¾ádná rozli¹ení a (SDL_Rect **)-1 oznamuje, ¾e jakékoli rozli¹ení je v poøádku.</p>

<p>Pokud se za parametr format pøedá NULL, bude seznam vztáhnut vzhledem k SDL_GetVideoInfo()-&gt;vfmt (viz dále). Pøi zji¹»ování jsou spí¹e dùle¾ité flagy ne¾ formát pixelù. Pokud by bylo napøíklad pøedáno SDL_HWSURFACE, hledalo by se pouze v hardwarovì podporovaných módech.</p>

<p>Struktura obdélníku je definována následovnì. Atributy x a y specifikují pozici levého horního rohu, w a h rozmìry. Jednotky jsou v pixelech.</p>

<pre>
typedef struct
{
	Sint16 x, y;
	Uint16 w, h;
} SDL_Rect;
</pre>

<p>Proto¾e bychom zbyteènì zabøedli do v tuto chvíli ne zrovna ¾ivotnì dùle¾itých detailù, bude struktura SDL_PixelFormat popsána a¾ nìkdy v budoucnu.</p>


<h2>Zji¹tìní informací o grafickém hardware</h2>

<p>Funkce SDL_GetVideoInfo() vrátí read only ukazatel na strukturu SDL_VideoInfo, která obsahuje informace o grafickém hardware. Pokud bude volána pøed SDL_SetVideoMode(), bude atribut vfmt obsahovat formát pixelù &quot;nejvhodnìj¹ího&quot; video módu. V pøípadì volání po SDL_SetVideoMode() bude obsahovat aktuální formát.</p>

<pre>
SDL_VideoInfo *SDL_GetVideoInfo(void);
</pre>

<p>Struktura SDL_VideoInfo se pou¾ívá pouze pøi volání této funkce a je deklarována takto:</p>

<pre>
typedef struct
{
	Uint32 hw_available :1; // Lze vytvoøit hardwarové surface?
	Uint32 wm_available :1; // Lze komunikovat se správcem oken?
	Uint32 blit_hw      :1; // Akcelerovaný blitting HW --&gt; HW
	Uint32 blit_hw_CC   :1; // Akcelerovaný blitting s Colorkey
	Uint32 blit_hw_A    :1; // Akcelerovaný blitting s Alpha
	Uint32 blit_sw      :1; // Akcelerovaný blitting SW --&gt; HW
	Uint32 blit_sw_CC   :1; // Akcelerovaný blitting s Colorkey
	Uint32 blit_sw_A    :1; // Akcelerovaný blitting s Alpha
	Uint32 blit_fill    :1; // Akcelerované vyplòování barvou?
	Uint32 video_mem;       // Celkové mno¾ství video pamìti v kB
	SDL_PixelFormat *vfmt;  // Formát grafického surface
} SDL_VideoInfo;
</pre>

<p>Pozn.: Pokud bude pod X11 pamì» nulová a ¾ádné hardwarové akcelerace dostupné, zmìòte grafický ovladaè z X11 napø. na DGA (pouze fullscreen a X11). V konzoli definujte systémovou promìnnou SDL_VIDEODRIVER ($ export SDL_VIDEODRIVER=dga) a spus»te program. Podrobnosti lze nalézt v SDL FAQ, sekce Development.</p>


<h2>Zji¹tìní video ovladaèe</h2>

<p>Do øetìzce specifikovaného parametrem namebuf bude ulo¾eno maximálnì maxlen znakù (vèetnì NULL) se jménem inicializovaného video driveru. Jedná se o jednoduché slovo jako x11, dga, directx nebo windib.</p>

<pre>
char *SDL_VideoDriverName(char *namebuf, int maxlen);
</pre>

<p>Pokud je¹tì nebyla grafika inicializována (SDL_Init()), bude vráceno NULL.</p>


<h2>Gamma funkce obrazovky</h2>

<p>SDL, pokud to hardware poèítaèe umo¾òuje, umí zmìnit &quot;gamma funkci&quot;, která kontroluje jas a kontrast barev zobrazených na obrazovce. Vzta¾ná hodnota je 1.0, tzn. nebudou se provádìt ¾ádné zmìny. Men¹í ne¾ jedna pøedstavuje ztmavení, vìt¹í ne¾ jedna zesvìtlení. Meze jsou pøibli¾nì 0.1 a 10.0.</p>

<pre>
int SDL_SetGamma(float redgamma, float greengamma, float bluegamma);
int SDL_SetGammaRamp(Uint16 *redtable, Uint16 *greentable, Uint16 *bluetable);
int SDL_GetGammaRamp(Uint16 *redtable, Uint16 *greentable, Uint16 *bluetable);
</pre>

<p>Pomocí druhé uvedené funkce lze pro ka¾dý kanál barev pøedat kompletní tabulku. Jedná se o pole 256 Uint16 èísel, které reprezentuje mapování mezi vstupem a výstupem. Vstup je indexem do pole a výstup udává ¹estnáctibitovou hodnotu gammy na daném indexu, její¾ velikost je zmìnìna na výstupní pøesnot. Pokud se za kanál pøedá NULL, zùstane nezmìnìn. Vrácení -1 znamená, ¾e funkce nejsou podporovány.</p>


<h2>Ukázkové programy</h2>

<h3>Vytvoøení okna &quot;jednoduchým&quot; zpùsobem</h3>

<p>Kód ukazuje pravdìpodobnì nejjednodu¹¹í (a také nejpou¾ívanìj¹í) vytvoøení okna. Tento postup není zrovna flexibilní, ale bývá vìt¹inou zcela dostateèný. <a href="./src/sdl_04_a.html">(zdrojový kód se zvýraznìním syntaxe)</a></p>

<h3>Vytvoøení okna s ovìøováním vlastností</h3>

<p>Druhý pøíklad je u¾ o nìco slo¾itìj¹í. Pokud nejsou nìkteré parametry vytváøeného okna validní, program se je pokou¹í upravovat tak dlouho, dokud nejsou pou¾itelné nebo nejdou dále upravit. Zároveò s testy vypisuje na konzoli informace, jaké modifikace právì provádí. Mù¾ete zkusit zadávat rùzné flagy, záporné velikosti okna a podobnì. <a href="./src/sdl_04_b.html">(zdrojový kód se zvýraznìním syntaxe)</a></p>

<h3>Vypsání informací o grafickém hardware</h3>

<p>Program nevytvoøí ¾ádné okno, ale po spu¹tìní pouze vypí¹e rùzné informace o grafickém hardware a pak se ukonèí. <a href="./src/sdl_04_c.html">(zdrojový kód se zvýraznìním syntaxe)</a></p>


<h2>Download</h2>

<p><ul>
<li><a href="./src/sdl_04_a.tar.gz">Pøíklad: Vytvoøení okna &quot;jednoduchým&quot; zpùsobem</a></li>
<li><a href="./src/sdl_04_b.tar.gz">Pøíklad: Vytvoøení okna s ovìøováním vlastností</a></li>
<li><a href="./src/sdl_04_c.tar.gz">Pøíklad: Vypsání informací o grafickém hardware</a></li>
<li><a href="sdl_04.tar.gz">Offline verze èlánku vèetnì v¹ech pøíloh</a></li>
</ul></p>


<h2>Pokraèování</h2>

<p>Pøí¹tì se koneènì zaèneme vìnovat grafice, tak¾e se tì¹te...</p>


<div class="autor">Michal Turek - Woq &lt;WOQ (zavináè) seznam.cz&gt;, 13.02.2005</div>

</body>
</html>
