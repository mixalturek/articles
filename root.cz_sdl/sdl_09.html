<?xml version="1.0" encoding="iso-8859-2"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="cs" lang="CS">

<head>
<meta http-equiv="content-type" content="text/html; charset=iso-8859-2" />
<meta http-equiv="content-language" content="cs" />
<meta name="author" content="all: Michal Turek - Woq; WOQ (zavináè) seznam.cz" />
<style type="text/css" media="all">@import "./data/style.css";</style>
<title>SDL: Hry nejen pro Linux (9)</title>
</head>

<body>

<h1>SDL: Hry nejen pro Linux (9)</h1>

<p class="perex">V dne¹ním dílu bude popsána knihovna SDL_ttf, která slou¾í pro výpisy textù do scény. Se zobrazením textù a pøedev¹ím s èeskými znaky bývá nìkdy potí¾, nicménì pou¾ití SDL_ttf je velice jednoduché a naprosto bezproblémové.</p>


<h2>Struènì o SDL_ttf</h2>

<p>SDL_ttf není samostatná knihovna, ale jedná se spí¹e o jakýsi obal/rozhraní knihovny <a href="http://www.freetype.org/">FreeType</a>, který vznikl kvùli maximálnímu zjednodu¹ení výpisu textù v SDL aplikacích. Jeho pou¾ití spoèívá v inicializaci, nahrání fontu z disku (formáty .FON, .TTF) a samotný výpis textu, který probíhá tak, ¾e je øetìzec nejdøíve vykreslen do SDL_Surface, který se poté pøilepí na obrazovku.</p>


<h2>Licence</h2>

<p>Knihovna SDL_ttf je stejnì jako samotné SDL ¹íøena pod GNU LGPL. Pøedtím, ne¾ ji zaènete pou¾ívat, mìli byste se seznámit se softwarovými patenty týkajícími se TrueType fontù a sami se rozhodnout, zda pou¾ít SDL_ttf, nebo zvolit jinou alternativu.</p>

<p>Jak to chápu já (nejsem právník!!!), tak ètení, konverze nebo generování TrueType fontù pod tyto patenty nespadá, navíc FreeType 2.0 ¾ádné (známé) patentované techniky nepou¾ívá. Podrobnosti lze najít u <a href="http://www.freetype.org/patents.html">knihovny FreeType</a>.</p>

<p>Druhé upozornìní se týká vlastních fontù, na mnoho z nich mají jejich tvùrci copyright. Nicménì toto by nemìl být a¾ tak velký problém, po internetu se potulují spousty fontù, které jsou volnì ¹iøitelné - google &quot;free fonts&quot;.</p>


<h2>Instalace, zprovoznìní</h2>

<p>Nejdøíve je nutné stáhnout a nainstalovat knihovnu <a href="http://www.freetype.org/">FreeType</a> (2.0 nebo novìj¹í) a a¾ poté se mù¾e pøistoupit k samotnému <a href="http://www.libsdl.org/projects/SDL_ttf/">SDL_ttf</a>. Obì bývají v standardních balíècích Linuxových distribucí, mo¾ná v¹ak bude nutné nainstalovat je¹tì jejich &quot;devel&quot; verze. SDL_ttf by mìlo fungovat na v¹ech systémech, ve kterých funguje SDL. Mimochodem dokumentaci lze najít <a href="http://www.libsdl.org/cgi/docwiki.cgi/SDL_5fttf">zde</a>.</p>

<p>Co se týèe vlastního programování, je nutné k parametrùm gcc pøidat volbu -lSDL_ttf, která zpùsobí pøilinkování knihovny. Do zdrojových kódù se dále musí inkludovat soubor SDL_ttf.h, ale to u¾ je samozøejmost.</p>


<h2>Inicializace, deinicializace</h2>

<p>Jak brzy zjistíme, obecné TTF funkce si vzaly za vzor SDL, rozdíly spoèívají v podstatì pouze ve jménì, které zaèíná na pøedponu TTF_, návratové hodnoty jsou také stejné.</p>

<pre>
int  TTF_Init(void);
void TTF_Quit(void);
int  TTF_WasInit(void);

char *TTF_GetError(void);
void TTF_SetError(const char *fmt, ...);
</pre>


<h2>Nahrávání fontù</h2>

<p>Hlavní funkcí pro loading fontu do aplikace je TTF_OpenFont(), která vrací ukazatel na TTF_Font. Tato struktura se bude pøedávat ostatním TTF funkcím, nikdy by se k ní z dùvodu budoucí kompatibility nemìlo pøistupovat pøímo. V parametrech funkce se specifikuje disková cesta k souboru a ptsize definuje velikost fontu v mìøítku 72 DPI.</p>

<pre>
TTF_Font *TTF_OpenFont(const char *file, int ptsize);
TTF_Font *TTF_OpenFontIndex(const char *file,
		int ptsize, long index)
</pre>

<p>Druhá uvedená funkce má v podstatì stejný význam, jako první, ale v posledním parametru lze navíc urèit, který font ze souboru, pokud jich obsahuje více, se má pou¾ít. První bývá v¾dy na indexu 0 a pokud bude pøedáno èíslo vy¹¹í, ne¾ jich ve skuteènosti obsahuje, pou¾ije se poslední z nich.</p>

<p>Pro nahrání fontu existuje je¹tì jedna funkce, která v¹ak nepracuje se soubory na disku, ale s daty v pamìti.</p>

<pre>
TTF_Font *TTF_OpenFontIndexRW(SDL_RWops *src,
		int freesrc, int ptsize, long index);
</pre>

<p>Po skonèení práce s fontem by nemìlo být nikdy zapomenuto na jeho uvolnìní...</p>

<pre>
void TTF_CloseFont(TTF_Font *font)
</pre>


<h2>Renderování textu</h2>

<p>V úvodním odstavci u¾ bylo zmínìno, ¾e zobrazení textu probíhá dvoustupòovì, nejdøíve se vytvoøí surface s vykresleným øetìzcem, se kterým se mù¾e dále pracovat - napøíklad zobrazit ho na obrazovku pomocí SDL_Blit(). Pro vytvoøení tohoto surface slou¾í celkem devìt funkcí, které se dají rozdìlit do tøí skupin a to buï podle zpùsobu vykreslování, nebo podle formátu pøedaného øetìzce.</p>

<p>Pokud je øetìzec v kódování LATIN1 (ISO 8859-1, 7-bitový anglický text), renderuje se funkcemi se symbolickým jménem TTF_RenderText_*(), je-li v Unicode utf8, pou¾ívá se TTF_RenderUTF8_*() a funkce TTF_RenderUNICODE_*() slou¾í pro vykreslení øetìzce ve formátu Unicode utf16.</p>

<p>Druhý typ dìlení spoèívá v technice a kvalitì vykreslení. Základem jsou funkce TTF_Render*_Solid(), které nepou¾ívají ¾ádný typ vyhlazování. Funkce se jmény TTF_Render*_Shaded() vyhlazování sice pou¾ívají, ale neumí vytvoøit prùhledné pozadí. U tøetího typu, TTF_Render*_Blended(), je text vyhlazený a pozadí prùhledné.</p>

<p>Na uvedeném obrázku jsou názornì vidìt definované rozdíly. Øetìzce byly vykresleny bílou barvou na modré pozadí okna, u druhého z nich je navíc definováno èerné pozadí.</p>

<div class="img"><img src="./data/09_solid_shaded_blended.png" width="340" height="125" alt="Ukázka módù solid, shaded, blended" /></div>

<p>Jak u¾ bylo øeèeno, v¹ech devìt funkcí si je velmi podobných. V¹echny vracejí ukazatel na vytvoøený surface s textem. Za první parametr se pøedává ukazatel na strukturu fontu, v druhém se specifikuje øetìzec a tøetí slou¾í k definování barvy textu. U druhého typu, Shaded, se navíc pøedává je¹tì barva pozadí.</p>

<pre>
SDL_Surface *TTF_RenderText_Solid(TTF_Font *font,
		const char *text, SDL_Color fg);
SDL_Surface *TTF_RenderUTF8_Solid(TTF_Font *font,
		const char *text, SDL_Color fg);
SDL_Surface *TTF_RenderUNICODE_Solid(TTF_Font *font,
		const Uint16 *text, SDL_Color fg);

SDL_Surface *TTF_RenderText_Shaded(TTF_Font *font,
		const char *text, SDL_Color fg,
		SDL_Color bg);
SDL_Surface *TTF_RenderUTF8_Shaded(TTF_Font *font,
		const char *text, SDL_Color fg,
		SDL_Color bg);
SDL_Surface *TTF_RenderUNICODE_Shaded(TTF_Font *font,
		const Uint16 *text, SDL_Color fg,
		SDL_Color bg);

SDL_Surface *TTF_RenderText_Blended(TTF_Font *font,
		const char *text, SDL_Color fg);
SDL_Surface *TTF_RenderUTF8_Blended(TTF_Font *font,
		const char *text, SDL_Color fg);
SDL_Surface *TTF_RenderUNICODE_Blended(TTF_Font *font,
		const Uint16 *text, SDL_Color fg);
</pre>

<p>Funkce typu Solid generují osmi bitový paletový surface, u kterého první (resp. nultý) pixel specifikuje barvu pozadí a druhý barvu textu. U funkcí Shaded je zvlá¹tním pixelem pouze ten první, proto¾e kvùli barevným pøechodùm na okrajích znakù nemù¾e být barva textu urèena jednoznaènì. Blended funkce vytváøejí tøiceti dvou bitový surface ve formátu ARGB. Text se tedy renderuje ve vysoké kvalitì s alfa blendingem, na druhou stranu je tato metoda o nìco pomalej¹í.</p>

<p>SDL_ttf dále definuje funkce pro vykreslení jednoho (Unicode) znaku.</p>

<pre>
SDL_Surface *TTF_RenderGlyph_Solid(TTF_Font *font,
		Uint16 ch, SDL_Color fg);
SDL_Surface *TTF_RenderGlyph_Shaded(TTF_Font *font,
		Uint16 ch, SDL_Color fg, SDL_Color bg);
SDL_Surface *TTF_RenderGlyph_Blended(TTF_Font *font,
		Uint16 ch, SDL_Color fg);
</pre>


<h2>Pøíklad na výpis textu</h2>

<p>Kompletní pøíklad vykreslení textu vèetnì inicializace, nahrání fontu a deinicializace by mohl vypadat následovnì.</p>

<pre>
// Globální promìnná
TTF_Font *g_font;


// Inicializace (za SDL_Init())
if(TTF_Init() == -1)
{
	printf("Unable to initialize SDL_ttf: %s\n",
			TTF_GetError());
	return false;
}

g_font = TTF_OpenFont("font.ttf", 12);
if(!g_font)
{
	printf("Unable to open font: %s\n",
			TTF_GetError());
	return false;
}


// Vykreslování
SDL_Color col = { 255, 255, 255, 0 };
SDL_Rect rect = { 20, 20, 0, 0 };
SDL_Surface *text;

text = TTF_RenderText_Solid(g_font, "Text", fg_col);
if(text != NULL)
{
	SDL_BlitSurface(text, NULL, g_screen, &amp;rect);
	SDL_FreeSurface(text);
}


// Deinicializace
if(g_font != NULL)
{
	TTF_CloseFont(g_font);
	g_font = NULL;
}
TTF_Quit();
</pre>


<h2>Dal¹í u¾iteèné funkce</h2>

<p>Pomocí následujících dvou funkcí lze specifikovat/dotázat se, zda má být font vykreslován normálnì, tuènì, kurzívou nebo podtr¾ený. Za parametr style lze pøedat binárnì ORovanou kombinaci symbolických konstant TTF_STYLE_NORMAL, TTF_STYLE_BOLD, TTF_STYLE_ITALIC a TTF_STYLE_UNDERLINE.</p>

<pre>
void TTF_SetFontStyle(TTF_Font *font, int style);
int TTF_GetFontStyle(TTF_Font *font);
</pre>

<p>Pixelové rozmìry øetìzce po vykreslení, které lze pou¾ít napøíklad pøi zarovnávání (doleva/na støed/doprava) lze získat funkcemi</p>

<pre>
int TTF_SizeText(TTF_Font *font,
		const char *text,
		int *w, int *h);
int TTF_SizeUTF8(TTF_Font *font,
		const char *text,
		int *w, int *h);
int TTF_SizeUNICODE(TTF_Font *font,
		const Uint16 *text,
		int *w, int *h);
</pre>

<p>Funkce TTF_FontHeight() vrátí maximální vý¹ku pøedaného fontu v pixelech. Tato hodnota v¹ak není moc vhodná pro posun na dal¹í øádek, proto¾e by byly moc blízko u sebe. K tomu slou¾í TTF_FontLineSkip(). Mimochodem SDL_ttf neposkytuje ¾ádné funkce pro víceøádkové výpisy textu, programátor si je musí implementovat sám.</p>

<pre>
int TTF_FontHeight(TTF_Font *font);
int TTF_FontLineSkip(TTF_Font *font);
</pre>

<p>Hodnota vrácená funkcí TTF_FontAscent() oznaèuje vzdálenost od horního okraje fontu k jeho základní lince, která se dá pou¾ít pøi vykreslování znakù relativnì k hornímu okraji. TTF_FontDescent() se naopak vztahuje k okraji dolnímu.</p>

<pre>
int TTF_FontAscent(TTF_Font *font);
int TTF_FontDescent(TTF_Font *font);
</pre>

<p>Kompletní informace o rozmìrech urèitého znaku lze získat pomocí funkce TTF_GlyphMetrics(). Jednotlivé parametry vysvìtluje obrázek ní¾e (byl pøevzat ze SDL_ttf dokumentace a pøedtím z FreeType dokumentace). Velice rozsáhlý èlánek o GlyphMetrics lze najít <a href="http://freetype.sourceforge.net/freetype2/docs/tutorial/step2.html">v dokumentaci knihovny FreeType</a>.</p>

<pre>
int TTF_GlyphMetrics(TTF_Font *font, Uint16 ch,
		int *minx, int *maxx,
		int *miny, int *maxy,
		int *advance);
</pre>

<div class="img"><img src="./data/09_glyphmetrics.png" width="388" height="253" alt="Význam parametrù funkce TTF_GlyphMetrics()" /></div>

<p>Pøi práci s ¹irokými Unicode znaky mù¾e nastat situace, ¾e budou byty ve znaku vzhledem k procesoru prohozené (little/big endian). Pomocí funkce TTF_ByteSwappedUNICODE() lze tento stav zmìnit. Pøi pøedání nenulové hodnoty (UNICODE_BOM_SWAPPED) se budou byty prohazovat, s nulou (UNICODE_BOM_NATIVE) nebudou.</p>

<pre>
void TTF_ByteSwappedUNICODE(int swapped);
</pre>

<p>Poslední funkce, které budou probrány, poskytují spí¹e informativní hodnoty. Jsou jimi jméno rodiny fontu, jeho typ, jestli je font proporcionální nebo ne a poèet facù.</p>

<pre>
char *TTF_FontFaceFamilyName(TTF_Font *font);
char *TTF_FontFaceStyleName(TTF_Font *font);
int  TTF_FontFaceIsFixedWidth(TTF_Font *font);
long TTF_FontFaces(TTF_Font *font);
</pre>


<h2>Ukázkové programy</h2>

<h3>Výpis textu pomocí SDL_ttf</h3>

<p>Ukázkový program je dnes relativnì jednoduchý, na modrém pozadí je zobrazeno nìkolik øádek textu. Ka¾dá øádka se kreslí jinou technikou a je ukázán i výpis èeských znakù. V levém dolním rohu se zobrazují i informace o pou¾itém fontu. <a href="./src/sdl_09_a.html">(zdrojový kód se zvýraznìním syntaxe)</a></p>

<div class="img"><img src="./data/09_prog_a.png" width="328" height="269" alt="Výpis textu pomocí SDL_ttf" /></div>


<h2>Download</h2>

<p><ul>
<li><a href="http://www.freetype.org/">Knihovna FreeType</a></li>
<li><a href="http://www.libsdl.org/projects/SDL_ttf/">Knihovna SDL_ttf</a> (<a href="http://www.libsdl.org/cgi/docwiki.cgi/SDL_5fttf">dokumentace</a>)</li>
<li><a href="./src/sdl_09_a.tar.gz">Pøíklad: Výpis textu pomocí SDL_ttf</a></li>
<li><a href="sdl_09.tar.gz">Offline verze èlánku vèetnì v¹ech pøíloh</a></li>
</ul></p>


<h2>Pokraèování</h2>

<p>V pøí¹tím dílu bude probrána komunikace se správcem oken (zmìna titulku a ikony, pøepínání do fullscreenu atd.), na konci nakousneme zpracování událostí.</p>


<div class="autor">Michal Turek - Woq &lt;WOQ (zavináè) seznam.cz&gt;, 19.03.2005</div>

</body>
</html>
