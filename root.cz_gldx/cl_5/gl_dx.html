<?xml version="1.0" encoding="ISO-8859-2"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="cz" lang="CZ">
<head>

<meta http-equiv="content-type" content="text/html; charset=ISO-8859-2" />
<meta http-equiv="content-language" content="cs" />
<meta http-equiv="content-script-type" content="text/javascript" />
<meta http-equiv="content-style-type" content="text/css" />

<meta name="robots" content="all, follow" />
<meta name="resource-type" content="document" />

<meta name="description" content="Porovnání 3D grafických knihoven OpenGL a Direct3D" />
<meta name="keywords" content="opengl, gl, directx, dx, direct3d, d3d, 3d, grafika" />
<meta name="author" content="all: Michal Turek - Woq; woq (zavináè) seznam.cz" />
<meta name="copyright" content="Copyright (c) 2004 Michal Turek - Woq" /><!-- Ne¾ to vyjde na root.cz :-] -->

<title>OpenGL a Direct3D</title>

<link href="style.css" rel="stylesheet" type="text/css" media="all" />
<link href="print.css" rel="stylesheet" type="text/css" media="print" />

</head>
<body>

<div id="text_stranky">

<h1>OpenGL a Direct3D V.</h1>

<p id="uvod">V jednom z pøedchozích dílù jsme se vìnovali programátorskému hledisku práce v na¹ich dvou knihovnách. Na toto téma nyní navá¾eme jejich architekturou, se kterou souvisejí dal¹í výrazné výhody a nevýhody.</p>


<h3>Architektura</h3>

<p>Z dosavadního popisu je více ne¾ jasné, ¾e se architektura OpenGL a Direct3D výraznì li¹í.</p>

<div class="okolo_img"><img src="img/arch_gl.png" width="180" height="115" alt="Architektura OpenGL" /><br />Architektura OpenGL</div>

<p>OpenGL pøedstavuje cca. 150 funkcí, s jejich¾ pomocí programátor komunikuje pøímo s hardwarem karty. Pokud se v poèítaèi 3D akcelerátor nenachází, mohou se v¹echny výpoèty realizovat softwarovì. Obecnì se dá øíci, ¾e o tom, co se po¹le hardwaru a co ne, rozhoduje výhradnì implementace OpenGL (ten, kdo ji naprogramoval) a ka¾dá implementace pracuje jinak. Jedinou podmínkou v¹ak je, ¾e se pro aplikaci musí navenek tváøit, ¾e podporuje naprosto v¹e a pøedem definovaným zpùsobem.</p>

<p>Témìø v¹echny zmìny v OpenGL (1.1, 1.2 atd.) spoèívají v pøidání extensionù, které u¾ za dobu od svého uvedení podporuje naprostá vìt¹ina bì¾nì pou¾ívaných karet, do &quot;základního standardu&quot;. Pùvodnì navr¾ená koncepce tedy zùstává prakticky nezmìnìna. Kromì toho je v¾dy mo¾né jakékoli HW funkce nových karet, které se nenachází v &quot;základním standardu&quot; pou¾ívat pøes extensiony.</p>

<p>Jedinou nevýhodou roz¹íøení (a docela podstatnou) je jejich mno¾ství. Nìkolik desítek by bylo je¹tì bez vìt¹ích problémù, nicménì v souèasnosti zaèíná jejich poèet u nových grafických karet dosahovat øádu stovek (odhaduji cca. 200) a stále roste. Druhou nevýhodou je, ¾e naprostá vìt¹ina z nich je málo popsaná. Samozøejmì myslím v èe¹tinì, anglicky mluvící (rozumìj ètoucí :-) programátoøi vìt¹í problémy mít nebudou.</p>

<p>Architektura Direct3D je oproti OpenGL, které le¾í pøímo na hardwaru, o nìco slo¾itìj¹í. Aplikaèní vrstva (to, co pí¹e programátor) komunikuje s vrstvou Direct3D, rozhraní je v tomto pøípadì v¾dy jednotné a to, co se nachází ve standardu Direct3D dané verze, je v¾dy mo¾no provést, pøièem¾ nezále¾í na tom, jestli je toho HW schopen. Poslední z vrstev, kdy¾ nepoèítáme <span title="Device Driver Interface - ovladaèe karty">DDI</span> (tzv. ovladaèe karty), je vrstva <span title="Hardware Abstraction Layer">HAL</span>, kterou dodává ka¾dý výrobce grafické karty a která defakto vrstvì Direct3D oznamuje: &quot;Ano, toto udìlám na hardwaru, nestarej se o to.&quot;, respektive: &quot;Ne, toto hardware neumí, musí¹ to dopoèítat softwarovì.&quot; Obecnì se dá øíci, ¾e vrstva Direct3D musí být schopna kompletnì v¹echny efekty provést softwarovì a teoreticky umìt vykreslovat i bez jakékoli grafické karty v poèítaèi.</p>

<div class="okolo_img"><img src="img/arch_dx1.gif" width="200" height="248" alt="Aarchitektura Direct3D 9.0" /><br />Architektura Direct3D 9.0</div>

<p>Abych pravdu øekl, jsem tak trochu na rozpacích, proto¾e to, co jsem právì napsal vùbec nemusí být pravda - tedy celkový smysl je urèitì správný, ale podrobnosti mohou být jinak. Zkrátka, tak tomu rozumím já, v DirectX opravdu neprogramuji.</p>

<p>Vycházel jsem ze zdroje <a href="#literatura">[1]</a>. Zdroj <a href="#literatura">[3]</a> uvádí trochu odli¹nou strukturu, ve které zkratka HAL neznamená &quot;Hardware Abstraction Layer&quot;, ale &quot;Hardware Activation Layer&quot;. Dále je pøidána vrstva HEL (Hardware Emulation Layer), která filtruje vstupní funkce (to, co pí¹e programátor) a rozhoduje, jestli je grafická karta umí provést nebo ne. V pøípadì, ¾e ne, vypoète se efekt softwarovì pomocí této vrstvy, pokud ano, pou¾ije se HAL, která po¾ádá hardware. Dále je pøístupná i vrstva DirectDraw, kterou Direct3D pou¾ívá pro mapování textur. Dùvodem takto komplikované struktury je mo¾nost aplikace manipulovat s ovladaèi a dotazovat se na to, co karta ve skuteènosti umí.</p>

<div class="okolo_img"><img src="img/arch_dx2.png" width="183" height="117" alt="Jiná verze architektury Direct3D" /><br />Jiná verze architektury Direct3D</div>

<p>Kdybych mìl urèit, která z tìchto dvou verzí je správná, rozhodl bych se asi pro tu první. Pøedev¹ím proto, ¾e je to ti¹tìná kniha a ne PDF dokument stáhnutý z internetu a ¾e od verzí DX novìj¹ích (tu¹ím) ne¾ 7 chybí podpora 2D grafiky (kniha je o verzi 9.0). DirectDraw bylo tehdy slouèeno s Direct3D a u¾ jako takové neexistuje.</p>

<p>Tak èi tak, získal jsem zcela neplánovaný dùkaz, ¾e se po pøechodu na novìj¹í verzi DirectX mù¾ete zaèít uèit spoustu vìcí od znova. Opìt podotýkám, ¾e se OpenGL zmìnilo pouze minimálnì...</p>

<h3>Shrnutí architektury - výhody a nevýhody</h3>

<p>Struènì a neodbornì, jak tedy Direct3D pracuje? Jeho hlavní výhodou je, ¾e lze v¹echny pøevratné funkce nových grafických karet spustit i na starých kartách, a to i pøesto, ¾e nic takového vùbec nepodporují. Direct3D nemá nic podobného OpenGL extensionùm, proto aby udr¾elo krok, musí se neustále a co nejrychleji inovovat a pøidávat do sebe nové vlastnosti.</p>

<p>Na jednu stranu programátoøi mají jistotu, ¾e kdy¾ nìjakou extrémnì novou funkci pou¾ijí, tak se provede i na starém hardwaru (softwarovì), který v dobì svého vzniku nemìl nejmen¹í tu¹ení, ¾e nìco podobného bude kdy existovat. Na druhou stranu, pøi poèítání vìt¹iny vìcí na CPU, bude program tak pomalý, ¾e to stejnì nemá význam - hra (vìt¹inou se jedná o hry) bude prostì nehratelná.</p>

<p>Osobnì si nedoká¾u pøedstavit, ¾e by na softwaru bì¾el napø. vertex/fragment shader - oznaèení FPS (poèet snímkù za sekundu) by jednoznaènì ztratilo jakýkoli význam, spí¹e by se mohlo poèítat za kolik minut/hodin se vykreslí jeden snímek. Nevím, jestli mù¾e DirectX programátor nìjak zjistit, co karta podporuje (asi ano) a podle toho se rozhodnout, jestli pou¾ít efekt pøes kompletní emulaci pomocí DirectX (efekt, jak by ho provedl HW), èásteènou emulaci vlastním kódem (analogický efekt v hor¹í/mizerné kvalitì) nebo daný efekt nepou¾ít - v OpenGL je tohle na denním poøádku - o v¹em rozhoduje programátor aplikace. Akorát, ¾e kdyby chtìl OpenGL programátor pou¾ít kompletní softwarovou emulaci, jak ji dìlá Direct3D, musel by si v¹e naprogramovat sám, co¾ jak jistì uznáte, je prakticky neproveditelné... nicménì Microsoft to musí provádìt v ka¾dé verzi Direct3D.</p>

<p>Zmínìné architektury mají ve svém dùsledku je¹tì jeden efekt. Kdy¾ nìkdo implementuje OpenGL ve svém zaøízení, má mno¾inu funkcí, které budou fungovat hardwarovì a mno¾inu, kterou musí implementovat softwarovì, aby byly pro aplikaci dostupné naprosto v¹echny funkce nacházející se v obecném standardu. V pøípadì Direct3D, které si do sebe navá¾e ovladaèe karty, aby s nimi mohlo obousmìrnì komunikovat a zji¹»ovat si, co karta podporuje a co ne, se musí provádìt nároèné testy pro v¹echny karty, se kterými bude pracovat. U OpenGL toto odpadá.</p>


<a id="literatura"></a>
<h3>Literatura</h3>

<ul>
<li>[0] Vlastní zku¹enosti s 3D grafikou</li>
<li>[1] Clayton Walnum: Programujeme grafiku v Microsoft&reg; Direct3D (9.0), Computer Press 2004, první vydání, 358 stran</li>
<li>[2] Chip 01/2004, Hardwarový fotorealismus: Mo¾nosti moderních 3D grafických akcelerátorù, str. 96-100)</li>
<li>[3] <a href="http://nehe.opengl.cz/cl_gl_referat.pdf" target="_blank">Daniel Èech: OpenGL - Referát na praktikum z informatiky (PDF)</a> - Opravdu kvalitní text</li>
<li>[4] <a href="http://nehe.opengl.cz/cl_sdl_hry.pdf" target="_blank">Bernard Lidický: Nìkolik poznámek k tvorbì poèítaèových her (PDF)</a> - Vìnuje se pøedev¹ím tématùm, jaké hry programovat a v èem (pøenositelné knihovny Allegro a SDL)</li>
<li>[5] <a href="http://www.root.cz/clanek/2314">Linuxové hry (47): Unreal Tournament 2004</a> - Hlavní impuls pro vznik tohoto èlánku</li>
</ul>


<div>Pro server <a href="http://www.root.cz/">root.cz</a> napsal</div>
<div>Michal Turek - Woq <span class="m">&lt;WOQ (zavináè) seznam.cz&gt;</span></div>

</div><!-- div id="text_stranky" -->

</body>
</html>